<div class="character-details-container">
  <div class="container character-details-wrapper">
    <div class="row">
      <div class="col-12">
        <nav aria-label="breadcrumb" class="breadcrumb-nav">
          <ol class="breadcrumb">
            <li class="breadcrumb-item">
              <a routerLink="/characters" class="text-decoration-none">‚Üê Characters</a>
            </li>
            <li class="breadcrumb-item active" aria-current="page">
              @if (character()) {
                {{ character()?.name }}
              } @else {
                Character Details
              }
            </li>
          </ol>
        </nav>
      </div>
    </div>

    @if (isLoading()) {
      <app-loading-section />
    }

    @if (error() && !isLoading()) {
      <app-error-section [message]="error()!" (retry)="loadCharacter(characterId || '')" />
    }

    @if (character() && !isLoading() && !error()) {
      <div class="details-grid">
        <div class="image-section">
          <div class="card character-image-card shadow-sm">
            <div class="position-relative">
              <img
                [src]="character()?.image"
                class="card-img-top character-image"
                [alt]="character()?.name"
              />
            </div>
          </div>
        </div>

        <div class="info-section">
          <div class="card character-info-card shadow-sm">
            <div class="card-header">
              <h1 class="card-title">{{ character()?.name }}</h1>
            </div>
            <div class="card-body">
              <section class="info-section">
                <h2 class="section-title">Basic Information</h2>
                <div class="info-grid">
                  <app-info-item label="Gender" [value]="character()?.gender"></app-info-item>
                  <app-info-item label="Species" [value]="character()?.species"></app-info-item>
                  <app-info-item label="Origin" [value]="character()?.origin?.name"></app-info-item>
                  <app-info-item
                    label="Location"
                    [value]="character()?.location?.name"
                  ></app-info-item>
                  <app-info-item
                    label="Status"
                    [value]="character()?.status"
                    [isSpoiler]="true"
                    [isRevealed]="isStatusRevealed()"
                    [spoilerClass]="character()?.status?.toLowerCase() || 'unknown'"
                    (spoilerToggle)="toggleStatusSpoiler()"
                  ></app-info-item>
                </div>
              </section>

              <section class="info-section featured-section">
                <h2 class="section-title">Appearances</h2>
                @if (character()?.episode && (character()?.episode)!.length > 0) {
                  <div>
                    @for (
                      seasonData of seasonEpisodes();
                      track seasonData.season;
                      let first = $first
                    ) {
                      <div class="season-entry">
                        <span class="season-label">Season {{ seasonData.season }}:</span>
                        <span class="episode-list">
                          @if (seasonData.episodes.length === 1) {
                            Episode {{ formatEpisodeList(seasonData.episodes) }}
                          } @else {
                            Episodes {{ formatEpisodeList(seasonData.episodes) }}
                          }
                        </span>
                      </div>
                    }
                  </div>
                } @else {
                  <p>No episode information available.</p>
                }
              </section>
            </div>
          </div>
        </div>
      </div>
    }
  </div>
</div>
